ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  # Create Service
  fnf-demo:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Description: 'Demo for use FnF to implements second level time trigger '
      Policies:
        - AliyunFnFFullAccess
        #- AliyunLogFullAccess
#      LogConfig:
#        Project: test-fc-santi
#        Logstore: test

    # Create timer function and fc time trigger
    timer:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Initializer: timer.initialize
        Handler: timer.handler
        Runtime: python3
        CodeUri: './src/timer.py'
        MemorySize: 128
        Timeout: 60

      # time trigger invoke every 1 minute
      Events:
        trigger:
          Type: Timer
          Properties:
            Payload: '{"flow_name": "demo-timer-seconds", "input": {"duration": 1, "data": "hello world"}}'
            CronExpression: "@every 1m"
            Enable: true

    # Create timer-gen function
    timer-gen:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: gen.handler
        Runtime: python3
        CodeUri: './src/gen.py'
        MemorySize: 128
        Timeout: 60

    # Create timer-handler function
    timer-handler:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: handler.handler
        Runtime: python3
        CodeUri: './src/handler.py'
        MemorySize: 128
        Timeout: 60